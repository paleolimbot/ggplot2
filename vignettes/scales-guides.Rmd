---
title: "Scales and Guides Brainstorming"
output: rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{Scales and Guides Brainstorming}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ggplot2)
library(grid)
library(gtable)
draw <- gridExtra::grid.arrange
```

## ggplot2 data spaces

- User data space (users)

```{r}
p <- ggplot(mpg, aes(class, cty)) + geom_boxplot()
p
```

- Transformed data space (some stats, scales)

```{r}
p + scale_y_log10(breaks = seq(10, 35, 5), labels = format(log10(seq(10, 35, 5))))
```

- Mapped data space (some stats, geoms, coords)

```{r}
p + 
  scale_y_log10(breaks = seq(10, 35, 5), labels = format(log10(seq(10, 35, 5)))) +
  scale_x_discrete(labels = paste0(1:7, "L"))
```

- Coordinate data space (grobs within the panel)

```{r}
p + 
  scale_y_log10(breaks = seq(10, 35, 5), labels = format(-log10(seq(10, 35, 5)))) +
  scale_x_discrete(labels = paste0("-", 1:7, "L")) +
  # won't work unless you have remotes::install_github("tidyverse/ggplot2#3380")
  coord_trans(y = "reverse", x = "reverse")
```

- Rescaled data space (grobs outside the panel)

```{r}
p + 
  scale_y_log10(
    breaks = seq(10, 35, 5), 
    labels = format(1 - scales::rescale(-log10(seq(10, 35, 5)), from = -c(0.9247512, 1.5735593)))
  ) +
  scale_x_discrete(
    labels = format(1 - scales::rescale(1:7, from = c(0.4, 7.6)))
  ) +
  # won't work unless you have remotes::install_github("tidyverse/ggplot2#3380")
  coord_trans(y = "reverse", x = "reverse")
```

## Scales and guides

```{r}
p <- ggplot(
  mpg, 
  aes(class, cty, col = displ, shape = drv)
) + 
  geom_boxplot(aes(fill = drv)) +
  geom_point(position = position_jitterdodge(jitter.width = 0.2)) 
p
```

Scales:

- colour (continuous)
- fill (discrete)
- shape (discrete)
- **x (discrete)**
- **y (continuous)**

Plot guides:

- colour (`guide_colourbar()` with `position = "right"`)
- fill (`guide_legend()` with `position = "right"`)
- shape (`guide_legend()` with `position = "right"`, merged with fill guide)

Panel guides:

- **x ("axis" guide with `position = "bottom"`)**
- **y ("axis" guide with with `position = "left"`)**
- **x and y ("grid" guide with with `position = "background"`)**

```{r, eval=FALSE}
... +
  panel_guides(
    guide_axis(aesthetics = "x", position = "bottom"),
    guide_axis(aesthetics = "y", position = "left"),
    guide_grid(aesthetics = c("x", "y"), position = "background")
  )
```


## Position guides and coordinate systems

```{r}
p + coord_polar()
```

Here, the panel guides are:

- x ("axis" (???) guide with `position = "foreground"`)
- y ("axis" guide with  `position = "left"`, with a transform applied in rescaled data space)
- x + y ("grid" guide with `position = "background"`)

```{r, eval=FALSE}
... +
  panel_guides(
    guide_axis(aesthetics = "y", position = "bottom"),
    guide_axis(aesthetics = "x", position = "foreground", override.aes = list(y = Inf)),
    guide_grid(aesthetics = c("x", "y"), position = "background")
  )
```

## Second axes

```{r}
p +
  scale_y_continuous(
    sec.axis = sec_axis(
      ~235.215 / ., 
      name = "L/100 km"
    )
  )
```

Here, the position guides are:

- x ("axis" guide with `position = "bottom"`)
- y ("axis" guide with `position = "left"`)
- y ("axis" guide with `position = "right"` with a transform applied in user data space)
- x + y ("grid" guide with `position = "background"`)

```{r, eval=FALSE}
... +
  panel_guides(
    guide_axis(aesthetics = "x", position = "bottom"),
    guide_axis(aesthetics = "y", position = "left", trans = identity_trans()),,
    guide_axis(aesthetics = "y", position = "right", trans = as_lazy_trans(~235 / .)),
    guide_grid(aesthetics = c("x", "y"), position = "background")
  )
```

## Rotated coordinate systems

```{r}
ggspatial::load_longlake_data()
ggplot(longlake_depthdf) +
  geom_sf() +
  coord_sf(crs = 26910) +
  scale_x_continuous(expand = expand_scale(2)) 
```

- x + y ("graticule" guide with `position = c("left", "bottom", "background")`)

```{r, eval=FALSE}
... +
  panel_guides(
    guide_graticule(
      aesthetics = c("x", "y"),
      position = c("background", "left", "bottom")
    )
  )
```

## Things that ggplot2 might be able to do

### Smarter handling of overlappling labels

```{r}
p +
  scale_y_continuous(breaks = scales::extended_breaks(n = 100))
```

```{r, eval=FALSE}
... +
  panel_guides(
    y = guide_axis(angle = ..., check.overlap = ..., n_dodge = ...)
  )
```

### Minor ticks

```{r}
p +
  annotate("text", x = -Inf, y = seq(12.5, 32.5, by = 5), label = "-", hjust = 1, size = 3) +
  coord_cartesian(clip = "off") +
  theme_classic()
```

```{r, eval=FALSE}
... +
  theme(axis.ticks.minor.length = unit(0.2, "pt"))
```

### Manual specifiation of tick locations/labels

```{r}
knitr::include_graphics("right_axis_values.png")
```

```{r, eval=FALSE}
... +
  panel_guides(
    guide_axis_manual("y", values = ..., labels = ..., gpar = tibble(...))
  )
```

### Aesthetics applied to tick marks/labels

```{r}
ggplot(mpg, aes(class, hwy, col = class)) +
  geom_jitter()
```

### Multiple position guides on the same side of the plot?

```{r}
knitr::include_graphics("multiple_posigion_guides.png")
```

```{r, eval=FALSE}
... +
  panel_guides(
    guide_axis("y", position = "left"),
    guide_axis("y", position = "left", trans = age_depth_trans(...))
  )
```

### Heiarchical scales/axis guides?

```{r}
knitr::include_graphics("heiarch_scale.png")
```

### hclust scales/gudies?

```{r}
knitr::include_graphics("cor_clust.png")
```
